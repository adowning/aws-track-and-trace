AWSTemplateFormatVersion: '2010-09-09'
Parameters:
  CloudFrontOAI:
    Type: String
    Default: CloudFront OAI ID
  CloudFrontOAICanonical:
    Type: String
    Default: Your CloudFront OAI Canonical User
  MyUserEmail:
    Type: String
    Default: pelaym+jlrd9mvp@amazon.com
  MyUsername:
    Type: String
    Default: sm
Resources:
  UsersStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      Parameters:
        MyUserEmail: !Ref MyUserEmail
        MyUsername: !Ref MyUsername
      Tags:
        - 
          Key: Component
          Value: d9mvp
        - 
          Key: Author
          Value: Pelayo Margareto <pelaym@amazon.com>
        - 
          Key: Role
          Value: aws-prototyping-labs
      TemplateURL: ./dashboard-users.yaml
  WebappStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      Parameters:
        CloudFrontOAI: !Ref CloudFrontOAI
        CloudFrontOAICanonical: !Ref CloudFrontOAICanonical
        UserPoolId: !GetAtt UsersStack.Outputs.UserPoolId
        UserPoolProviderName: !GetAtt UsersStack.Outputs.UserPoolProviderName
      Tags:
        - 
          Key: Component
          Value: d9mvp
        - 
          Key: Author
          Value: Pelayo Margareto <pelaym@amazon.com>
        - 
          Key: Role
          Value: aws-prototyping-labs
      TemplateURL: ./dashboard-webapp.yaml
Outputs:
  AwsRegion:
    Value: !Ref AWS::Region
    Description: Region where the app is deployed
  AwsAccountId:
    Value: !Ref AWS::AccountId
    Description: Account ID where the app is deployed
  UserPoolId:
    Value: !GetAtt UsersStack.Outputs.UserPoolId
    Description: ID of the solution's user pool
  UserPoolClientId:
    Value: !GetAtt WebappStack.Outputs.UserPoolClientId
    Description: Webapp UserPoolClient id
  IdentityPoolId:
    Value: !GetAtt WebappStack.Outputs.IdentityPoolId
    Description: Identity Pool id
  WebsiteBucketName:
    Value: !GetAtt WebappStack.Outputs.WebsiteBucket
    Description: Name of the bucket used for the website